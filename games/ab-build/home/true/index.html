<!DOCTYPE html>
<html>
<head>
<title>Bad Piggies Build</title>
<script type="text/javascript">
	var appConfig = {
			fullscreen: false,
			topics: [],
			token : undefined,
			authed: false,
			pathPrefix : "https://0-0-3-11-dot-latest-dot-angrybirds-build.appspot.com",
			staticPrefix: "/20121008-1433",
			profileThumbURL : "http://graph.facebook.com",
			appDomain : "bad-qa-piggy",
			serverRoot : "http://0-0-3-11-dot-latest-dot-angrybirds-build.appspot.com"
		};
</script>
<script  type="text/javascript" src="/20121008-1433/public/javascript/en/build.js"></script>
<link rel="stylesheet" media="screen" href="/20121008-1433/public/stylesheets/build.css" />
<!--  All Things Related to test -->
<link rel="stylesheet" media="screen" href="/20121008-1433/public/stylesheets/../jasmine/jasmine.css" />
<script  type="text/javascript" src="/20121008-1433/public/javascript/../jasmine/jasmine.js"></script>
<script  type="text/javascript" src="/20121008-1433/public/javascript/../jasmine/jasmine-html.js"></script>
<script  type="text/javascript" src="/20121008-1433/public/javascript/../jasmine/bdd.js"></script>
<!-- End of all things related to test -->

<script type="text/javascript">
// facebook
window.fbAsyncInit = function() {
    FB.init({
	      appId      : "262862370471045",
	      channelUrl : '/20121008-1433/public/channel.html',
	      status     : true,  
	      cookie     : true, 
	      xfbml      : false
    });
 
    // Log into facebook. If successful confirm the user by loggin in to our system.
    Piggies.social.init();
 };
 
 // Load the SDK Asynchronously
 (function(d){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all.js";
    ref.parentNode.insertBefore(js, ref);
 }(document));
 
 $(function(){
	 $(".fullScreenLink").click(function(){
		 document.getElementById("viewport").webkitRequestFullScreen();
		 return false;
	 });
	 //Disable the scrolling when zooming the flash player.
	 $('#flashObject').hover(function() {
 		if (Piggies.utils.isFF()) {			   
	    	document.onmousewheel = function(){ Piggies.utils.stopWheel(); } /* IE7, IE8 */
		    	if(document.addEventListener){ /* Chrome, Safari, Firefox */
		    	    document.addEventListener('DOMMouseScroll', Piggies.utils.stopWheel, false);
		    	}
		    } else {		    	    
	    	    $(document).bind('mousewheel DOMMouseScroll scroll',function(){ 
	    	    	Piggies.utils.stopWheel();	    	        
	    	    });			    	   
 	    }
 	    
 	}, function() {
		if (Piggies.utils.isFF()) {			    				   
	    	if(document.removeEventListener){ /* Chrome, Safari, Firefox */
	    	    document.removeEventListener('DOMMouseScroll', Piggies.utils.stopWheel, false);
	    	}
	    } else {
    		$(document).unbind('mousewheel DOMMouseScroll scroll'); 			    		
    	} 	    
 	});
	 
	 $("#toggle").click(function(){
		 pageRouter.home();
	 });
	 
	 $("#test-suite").click(function(){
		 Piggies.test.execute();
		 $("#page-container").hide();
		 return false;
	 });
 });
 
</script>

</head>
<body>

	<div class="cant-run transitioned">
		<h3>
			You need at least flash 11.3 to run build</h3>
	</div>

	<div id="page-container">
		<div id="ad-banner">
			<!--<div id="banner-info" style="width: 100%;">
				<span>Banner Goes Here!</span> <a id="test-suite" href="#"
					style="font-size: 22px; text-align: center; cursor: pointer; background: green;">Run
					Test</a>
					
			</div>-->
			<div class="banner-container">
				<span id="banner1" class="banner"></span>
				<span id="banner2" class="banner"></span>
			</div>
		</div>


		<div id="viewport" class="viewport">
			<div class="bg-layer"></div>
			<div class="bg-layer"></div>
			<div class="bg-layer"></div>
			<div class="bg-layer"></div>
			<div class="bg-layer"></div>

			<div id="page-layer" class="bg-layer">
				<div id="home-page">
					<div class="page">
						



<div class="page-content">
	<div id="play-popup" class="main-content">
		<div id="top-play-container" class="busy">
			<div id="searchContainer" class="spring">
				<form id="searchForm">
					<input id="searchInput" type="text"> <input type="submit"
						value="Search">
				</form>
			</div>
		</div>
		<!-- Level Listings that needs to be centered -->
		<div id="level-list" class="spring">
			<div class="level-page-container">
				<div class="level-page-wrapper spring"></div>
			</div>
			<div class="level-pager">
				<!--<span id="prev-chapter" class="prev-chunk special-btn">&lt;&lt;</span>-->
				<span id="prev-page" class="prev-page special-btn">&lt;</span>
				<div class="paging-container"></div>
				<span id="next-page" class="next-page special-btn">&gt;</span>
				<!--<span id="next-chapter" class="next-chunk special-btn">&gt;&gt;</span>-->
			</div>
		</div>
		<!-- End of level listings  -->
		<div class="sidebar">
			<div id="sidemenu">
				<div id="top-levels-menu"
					class="side-menu-link big-side-menu menu-spring">
					<span>Top Levels</span>
				</div>
				<div id="weekly-levels-menu"
					class="side-menu-link chain-menu small-side-menu menu-spring">
					<span>Weekly Levels</span>
				</div>
				<div id="friends-levels-menu"
					class="side-menu-link big-side-menu menu-spring">
					<span>Friends Levels</span>
				</div>
				<div id="my-levels-menu"
					class="side-menu-link chain-menu small-side-menu menu-spring">
					<span>My Levels</span>
				</div>
			</div>
		</div>
		
		<div id="busy-window" class="border-box spring">
			<div id="professor-pig"></div>
			<div id="busy-info">
				<span id="spinner" class="transitionedx"></span><span id="busy-text" class="side-menu-link">Looking for levels</span>
			</div>
		</div>
		
	</div>
</div>

<script id="level-template" type="text/x-jquery-tmpl">
	<div class="level-list public-level special-btn"
			data-level-name="{{name}}" 
			data-level-id="{{id || levelId}}"
			data-level-rank="{{rank}}" 
			data-level-likes="{{value}}"
			data-level-status="{{status}}" id={{levelId}}>

			<img class="level-thumbnail-tmpl" src="{{thumbUrl}}=s138" alt="{{name}}" />
	
			<div class="level-list-caption">
				<h3 class="cut-off-text">{{name}}</h3>
				<h4 class="cut-off-text">{{author}}</h4>
			</div>

			<div class="level-list-metadata">
				<div class="cover">
					<div class="level-list-rank rank-star {{rankClass(rank,value)}}" ><span>{{formatRank(rank)}}</span></div>
					<div class="level-list-like-btn"></div>
					<div class="level-list-likes">{{formatLikes(value)}}</div>
				</div>
			</div>
	</div>
</script>

<script id="featured-fevel-template" type="text/x-jquery-tmpl">
	<div class="current-featured-level" data-level-author="{{authorId}}" 
		data-level-level="{{levelId}}">

		<!-- top level row -->
		<div class="current-featured-level-metadata">
			<div class="current-featured-level-title cut-off-text">{{name}}</div>
			<div class="current-featured-author-title cut-off-text">{{author}}</div>
		</div>

		<!-- second row -->
		<div class="current-featured-level-profile">
			<img id="featuredProfileImage" class="current-featured-level-image" src="{{thumbUrl}}" />

			<div class="current-featured-level-info">
				<div class="current-featured-level-rank cut-off-text {{rankClass(rank,value)}}">
					<span>{{formatRank(rank,value)}}</span>
				</div>
				<div class="current-featured-like-count-container">
					<span class="current-featured-like-count">{{value}}</span> 
					<span class="current-featured-like-btn special-btn"></span>
				</div>
				<a href="#" class="current-featured-share-btn special-btn">
					<span class="current-featured-share-btn-img"></span> share
				</a>
			</div>				
		</div> 
	</div>
</script>

<script id="current-level-template" type="text/x-jquery-tmpl">
	<div class="current-level" data-level-id="{{levelId}}">
			<div class="currrent-level-author-image">
				<img src="http://graph.facebook.com/{{authorId}}/picture">
			</div>
			<div class="current-level-metadata">
				<h4 class="cut-off-text current-level-name">{{name}}</h4>
				<h5 class="cut-off-text current-level-play-count">{{playCount}}</h5>
				<span class="cut-off-text current-level-rank {{rankClass(rank,value)}}">{{formatRank(rank,value)}}</span>
			</div>
			<div class="current-level-likes">
				<a href="#" class="current-level-like-action"></a>
				<div class="current-level-like-count cut-off-text">{{value}}</div>
			</div>
			<div class="current-level-share">
				<a href="#">Share</a>
			</div>
			<div class="current-level-author-name">
				<h5>{{author}}</h5>
			</div>
		</div>
</script>

</div>
					<div class="page">
						<div id="front-page" class="page-content">
							<div id="bad-piggies-logo"></div>
							<div id="front-menu">
								<div id="levels-menu">
									<div id="popularlevels" class="home-menu-item special-btn">
										Top Levels</div>
									<div id="mylevels" class="home-menu-item special-btn">
										Friends Levels</div>
								</div>
								<div id="crane">
									<div id="build" class="home-menu-item special-btn">
										Build Levels</div>
								</div>
							</div>
							<div id="shovel" class="background-item"></div>
							<div id="rubbercone" class="background-item"></div>
						</div>
					</div>
					<div class="page">
						

<script type="text/javascript">

(function() {	
	
	$(function(){
		
		// Flash Events	
		flash.on(flash.eventTypes.LEVEL_PUBLISH,function(publishedData){
			currentLevel = levelFromJSON(publishedData);
			doPublish();
		});
		
	

		
		flash.on(flash.eventTypes.LEVEL_SCREEN_CAPTURED,function(screenData){
			onScreenShot(screenData);
		});
		

		flash.on(flash.eventTypes.BUY_CONSUMABLES, function(itemId, amount) {
			Piggies.shop.shopManager.consumables(itemId, amount).done(function() {
			}).fail(function() {
				alert("Could not buy " +amount+ " of " + itemId);
			}) ;
		});
				
		
		flash.on(flash.eventTypes.BUY_ITEM_COUNT, function(amount) {
			Piggies.shop.shopManager.increaseItemCount(amount).done(function() {
			}).fail(function() {
				alert("Could not increase item count by " + amount);
			}) ;
		});
			
		
		flash.on(flash.eventTypes.BUY_UNLOCK_ITEMS, function(itemId) {
			Piggies.shop.shopManager.unlock(itemId).done(function() {
			}).fail(function() {
				alert("Could not unlock item " + itemId);
			}) ;
		});
		
		flash.on(flash.eventTypes.BUY_COINS, function(amount) {
			Piggies.shop.shopManager.coins(amount).done(function(coins) {
				console.log("Sending new coins to FLASH: " + coins);
				editor.getFlash().onSetCoins(coins);
			}).fail(function() {
				alert("Could not buy coins!");
			}) ;
		});
	
		flash.on(flash.eventTypes.QUEST_REQUEST,function(){
			Piggies.build.questManager.getAllQuests().done(function(quest){
				editor.getFlash().onQuestsFetched(JSON.stringify(quest));
			}).fail(function(){
				alert("Could not fetch quest!");
			});
		});
		
		flash.on(flash.eventTypes.QUEST_START,function(quest){
			Piggies.build.questManager.start(quest).done(function(startedQuest, level) {
				if (level) {
					editor.getFlash().onQuestStarted(JSON.stringify(startedQuest), level);
				} else {
					editor.getFlash().onQuestStarted(JSON.stringify(startedQuest));
				}
			}).fail(function(){
				alert("Could not start quest!");
			});
		});

		flash.on(flash.eventTypes.QUEST_SAVED,function(quest, level){
			Piggies.build.questManager.save(quest, level).done(function(level){
				console.log("Quest saved: " + level);
			}).fail(function(){
				alert("Could not save quest!");
			});
		});

		flash.on(flash.eventTypes.QUEST_COMPLETED,function(quest,level, share){
			Piggies.build.questManager.complete(quest, level).done(function(completedQuest) {
				editor.getFlash().onQuestCompleted(JSON.stringify(completedQuest.quests),
						JSON.stringify(completedQuest.levelUpInfo));
				
				if (share) {
					flash.on(flash.eventTypes.SHARE_LEVEL_BUILD, function(levelId,  thumbUrl) {
						Piggies.fb.facebookManager.shareLevelBuild(levelId, completedQuest.levelName, completedQuest.thumbUrl)
							.then().done(function() {
								alert("Sharing Build session Done!");
							}).fail(function() {
								alert("Share Build session Fail!");
							}).progress(function(prog) {
								if(prog.progress == "aborted") {
									console.log("Sharing Build session Aborted");
								}
							});
					});
				}
				
			}).fail(function(){
				alert("Could not complete quest!");
			});
		});
			
		flash.on(flash.eventTypes.INITIALIZED, function(){			
			Piggies.social.init().done(function() {				
				editor.getFlash().login(JSON.stringify(Piggies.social.me));
			});

		});
	});
	
	function doResize(){
		Piggies.utils.underscore.delay(function(){
			flash.show($("#build-popup"));
		},1000);
	}
	
	function startResize(){
		//flash.hide();
	}
	
	var currentLevel = new Level();
	var screenShotDeferred;
	
	// ----------- Events ----------------
	pageRouter.on("PAGE:BUILD", function() {	
		// register for level loaded events
		currentLevel = new Level();
		Piggies.utils.underscore.delay(function(){
			
			// we are still in the build area
			if(pageRouter.isInView("build")){
				if(!flash.initialized){
					flash.on(flash.eventTypes.INITIALIZED,function(){
						flash.build(""); // Load an empty level to initialize a request for quest
					});
				}else{
					flash.build("");
				}
				Piggies.utils.underscore.delay(function(){
					flash.show($("#build-popup"));
					buildScreenshot(Cache.get("build-screenshot"));
				},500);	
			}
			
			pageEvents.on("WINDOW:RESIZE:END",doResize);
			pageEvents.on("WINDOW:RESIZE:START",startResize);
		},1200);
		
	});
	
	pageRouter.on("PAGE:HOME",function(){
		// create a static screen shot on the way to the home page.
		screenShotDeferred = $.Deferred().done(function(imageData){
			buildScreenshot(imageData);
		});
		
		if(flash.initialized) {
			flash.takeSnapshot();
		}
	
		pageEvents.off("WINDOW:RESIZE:END",doResize);
		pageEvents.off("WINDOW:RESIZE:START",startResize);
	});

	function onScreenShot(snapshot){
		currentLevel = levelFromJSON(snapshot);
		if(screenShotDeferred && screenShotDeferred.state() == "pending"){
			screenShotDeferred.resolve(snapshot.screen);
		}else{
			saveCurrentLevel().always(function() {
				savePending = false;
			});
		}
	}
	
	function buildScreenshot(imageData){
		// build the screenshot that will be placed in place of the flash when hidden
		//$("#build-popup").css("background", "url(data:image/png;base64,"+imageData+")");
		Cache.put("build-screenshot",imageData);
	}

})();
</script>

<div class="page-content">
	<div id="build-sidebar">
		<form method="post" action="/build/create;jsessionid=v3cyaddi4hcj1k9v8p8v7prlu" id="levelForm"><div style="display: none;"><input type="hidden" name="_sourcePage" value="lOtTeXlbbWkURrpONANMeNWeV9c4Uu4EleHcyMX53qQ=" /><input type="hidden" name="__fp" value="FohNhg86V7g=" /></div></form>	
	</div>
	<div id="build-popup" class="main-content"></div>
</div></div>
				</div>
			</div>
		</div>
		
		<!-- viewport -->
		<div id="social-bar-bg"></div> <!--  This is the light green background -->
		

<div id="social-bar" class="home">
	<div id="social-container">
		<div id="info-box">
			<div id="campaing-box" class="info-block spring">
				<h4 class="title">Competition</h4>
				<h1 class="content">4 Days</h1>
				<h3 class="footer">remaining!</h3>
			</div>
			<div id="level-box" class="info-block spring hide"></div>
		</div>

		<div id="people-box">
			<div id="people-container">
				<div class="hscroller-handle left">
					<span> &lt;</span>
				</div>
				<div class="hscroller spring">
					<div id="hscroller-bg"></div>
					<div class="hscroller-viewport spring"></div>
				</div>
				<div class="hscroller-handle right">
					<span>&gt;</span>
				</div>
			</div>
		</div>

		<div id="message-box">
			<div id="message-container" class="home">
				<div id="home-button" class="big-button special-btn"></div>
				<!--<div id="message-big-button" class="big-button special-btn"></div>-->
				<div id="message-small-button" class="small-button special-btn"></div>
				<div id="help-button" class="small-button special-btn"></div>
				<div id="sound-button" class="small-button special-btn"></div>
				<div id="small-message-button" class="small-button special-btn"></div>
			</div>
		</div>
	</div>
</div>

<script id="person-template" type="text/x-jquery-tmpl">
	<div class="person special-btn" data-id="{{id}}">
		<div class="person-container">
			<h4 class="name">{{name.split(" ")[0]}}</h4>
			<img class="picture" src="http://graph.facebook.com/{{id}}/picture">
		</div>
		<span class="likes spring">
			<span>99k</span>
		</span>
		<span class="crown"></span>
	</div>
</script>

<script id="person-unregistered-template" type="text/x-jquery-tmpl">
	<div class="person special-btn unregistered">
		<div class="person-container">
			<h4 class="invite">Invite!</h4>
			<img class="picture" src="http://graph.facebook.com/{{id}}/picture">
			<h4 class="name">{{name.split(" ")[0]}}</h4>
		</div>
		
	</div>
</script>

<script id="now-playing-template" type="text/x-jquery-tmpl">
	<div class="now-playing">
		<h2 class="cut-off-text">{{name}} Thanks södsoajdöocasjdcöaj</h2>
		<h5 class="cut-off-text">by {{author.split(" ")[0]}}</h5>

		<div id="now-playing-metadata">
			<span id="now-playing-like-btn" class="special-btn"></span>
			<span id="now-playing-likes" class="cut-off-text">{{value}}</span>
			<span id="now-playing-share-btn" class="special-btn"></span>
			<span id="now-playing-flag-btn" class="special-btn"></span>
			<span id="now-playing-rank" class="special-btn">{{formatRank(rank,value)}}</span>
		</div>

	</div>
	
</script><div id="footer">
			<div>
				<a class="footer-link" href="/footer/terms">Terms</a> <span>|</span> <a
					class="footer-link" href="/footer/policy">Privacy</a> <span>|</span> <a
					class="footer-link" href="/footer/contact">Contact</a> <span>|</span> <a
					class="footer-link" href="/footer/credits">Credits</a>
			</div>
			<div>
				Copyright &copy; 2012 Rovio Entertainment LTD</div>
		</div>
	</div>

	<div id="flashObject">
		<div id="flashHolder" class="show-flash"></div>
	</div>
	<div id="fb-root"></div>


	<div id="loading-animation">
		<span id="spinner-animation"></span>
		<span id="spinner-info" class="side-menu-link">Getting Ready!</span>
	</div>

</body>
</html>